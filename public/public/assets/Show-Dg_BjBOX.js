import{m as y,r as I,j as e,S as L,$ as S,L as D}from"./app-D15uHu8v.js";import{A as C}from"./AuthenticatedLayout-DAVqwqhD.js";import{C as u}from"./card.esm-CwHtpcZp.js";import{I as P}from"./image.esm-D-896_D_.js";import{B as h}from"./button.esm-BRKb10Wf.js";import{I as p}from"./InputError-zGy_9eYl.js";import{P as F}from"./PrimaryButton-BIkkRLjL.js";import{I as _}from"./inputtextarea.esm-UIqw5GRM.js";import{F as T}from"./fileupload.esm-CYb6dFuB.js";import{I as U}from"./InputLabel-ay4s_AAP.js";import"./ApplicationLogo-wBmO382G.js";import"./transition-D_4-xP8q.js";import"./index.esm-CsaMsn2H.js";import"./csstransition.esm-d_U1Ywqq.js";import"./keyfilter.esm-BFZpD1XT.js";import"./index.esm-CudRFHm8.js";import"./index.esm-DKhWp-KS.js";function $({comments:t,postId:a,auth:r}){const{data:l,setData:i,post:m,processing:j,reset:g,errors:o}=y({content:"",image:null}),[d,n]=I.useState(null),f=s=>{s.preventDefault(),m(route("comments.store",a),{onSuccess:()=>{g(),n(null)}})},N=s=>{const c=s.files[0];if(c){i("image",c);const x=new FileReader;x.onload=w=>{n(w.target.result)},x.readAsDataURL(c)}},b=s=>{confirm("このコメントを削除してもよろしいですか？")&&L.delete(route("comments.destroy",s))},v=s=>new Date(s).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"mb-4 text-xl font-semibold",children:"コメント"}),e.jsxs("form",{onSubmit:f,className:"mb-6",encType:"multipart/form-data",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(_,{value:l.content,onChange:s=>i("content",s.target.value),rows:3,placeholder:"コメントを入力してください",className:"p-2 w-full",required:!0}),e.jsx(p,{message:o.content,className:"mt-2"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(U,{htmlFor:"image",value:"画像（任意）"}),e.jsx(T,{id:"image",name:"image",accept:"image/*",maxFileSize:2e6,emptyTemplate:e.jsx("p",{className:"m-0",children:"ここに画像をドラッグ&ドロップするか、クリックしてアップロードしてください。"}),onSelect:N,chooseLabel:"選択",uploadLabel:"アップロード",cancelLabel:"キャンセル",className:"mt-1",auto:!0,customUpload:!0,uploadHandler:s=>s.options.clear()}),e.jsx(p,{message:o.image,className:"mt-2"}),d&&e.jsxs("div",{className:"relative mt-2",children:[e.jsx("p",{className:"mb-2 text-sm",children:"プレビュー:"}),e.jsxs("div",{className:"inline-block relative",children:[e.jsx("img",{src:d,alt:"Preview",className:"max-w-xs rounded-md"}),e.jsx("button",{type:"button",onClick:()=>{i("image",null),n(null)},className:"flex absolute -top-2 -right-2 justify-center items-center w-6 h-6 text-white bg-red-500 rounded-full hover:bg-red-600 focus:outline-none",children:"×"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(F,{disabled:j,children:"コメントを投稿"})})]}),e.jsx("div",{className:"space-y-4",children:t&&t.length>0?t.map(s=>e.jsx(u,{className:"shadow-sm",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("i",{className:"mr-2 pi pi-user"}),e.jsx("span",{className:"font-semibold",children:s.user.name}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:v(s.created_at)})]}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.content}),s.image_path&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:`/storage/${s.image_path}`,alt:"コメント画像",className:"mt-2 max-w-xs rounded-md"})})]}),r.user&&r.user.id===s.user_id&&e.jsx(h,{icon:"pi pi-trash",className:"p-button-rounded p-button-danger p-button-text",onClick:()=>b(s.id),tooltip:"削除"})]})},s.id)):e.jsx("p",{className:"py-4 text-center text-gray-500",children:"コメントはまだありません"})})]})}function Y({auth:t,post:a}){const r=a.photo?`/storage/${a.photo}`:null,l=new Date(a.created_at).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),i=e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"mr-2 pi pi-user"}),e.jsx("span",{className:"font-semibold",children:a.user.name})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("i",{className:"mr-2 pi pi-calendar"}),l]})]}),m=e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{children:[e.jsx("i",{className:"mr-2 pi pi-tag"}),e.jsx("span",{className:"text-sm",children:a.shop.name})]}),e.jsx(S,{href:route("dashboard"),children:e.jsx(h,{label:"ダッシュボードに戻る",icon:"pi pi-arrow-left",className:"p-button-sm"})})]});return e.jsxs(C,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"投稿詳細"}),children:[e.jsx(D,{title:"投稿詳細"}),e.jsx("div",{className:"py-12 pt-4",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsxs(u,{title:a.title,subTitle:a.shop.name,header:i,footer:m,className:"shadow-md",children:[e.jsx("div",{className:"mb-6 whitespace-pre-wrap",children:a.content}),r&&e.jsx("div",{className:"mt-4",children:e.jsx(P,{src:r,alt:"投稿画像",width:"100%",preview:!0})}),e.jsx($,{comments:a.comments,postId:a.id,auth:t})]})})})]})}export{Y as default};
